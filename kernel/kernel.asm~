SELECTOR_KERNEL_CS		equ		8

;导入函数和变量
extern		cstart
extern		gdt_ptr
extern		idt_ptr

[section .bss]
StackSpace		resb		2 * 1024
StackTop:					;栈顶

[section .text]

global	_start
global	testHandler

_start:
	mov		esp, StackTop
	sgdt	[gdt_ptr]		;把gdt_ptr导出到外部变量中，cstart()会用到
;	xchg	bx,bx
	call	cstart			;改变gdt_ptr, 让它指向新的GDT

	lgdt	[gdt_ptr]		;使用新的GDT
	lidt	[idt_ptr]		;新的idt
	
	mov		ah,0fh
	mov		al,'K'
	mov		[gs:((80 * 20 + 39) * 2)],ax
	jmp		$

testHandler:
	mov		ah,0fh
	mov		al,'I'
	mov		[gs:((80 * 21 + 39) * 2)],ax
	iret
